name: snowflake_cicd_process
on:
  push:
    branches:
      - main
  paths:
include:
   - /PROD
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: use python 3.8.x
      uses: actions/setup-python@v2
      with:
        python-version: '3.8.x'
    Run Schemachange
		env:
  SF_ACCOUNT: $(SF_ACCOUNT) 
	SF_USERNAME: $(SF_USERNAME)  
	SF_ROLE: $(SF_ROLE)
	SF_WAREHOUSE: $(SF_WAREHOUSE)
	SF_DATABASE: $(SF_DATABASE) 
	SNOWFLAKE_PASSWORD: $(secrets.SF_PASSWORD)
       run:
	echo "GITHUB_WORKSPACE: $GITHUB_WORKSPACE"
	python --version
	echo "step 1: installing schemachange"
	pip install schemachange	

	echo "step 2: running schemachange"
	schemachange -f $GITHUB_WORKSPACE/dbscripts -a $(SF_ACCOUNT) -u $(SF_USERNAME) -r $(SF_ROLE) -w $(SF_WAREHOUSE) -d $(SF_DATABASE) -c $(SF_DATABASE).SCHEMACHANGE.CHANGE_HISTORY --create-change-history-table
